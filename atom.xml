<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[RudyGems]]></title>
  <link href="http://matthewrudy.github.com/atom.xml" rel="self"/>
  <link href="http://matthewrudy.github.com/"/>
  <updated>2013-02-05T01:04:36+00:00</updated>
  <id>http://matthewrudy.github.com/</id>
  <author>
    <name><![CDATA[Matthew Rudy]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Configuring foreman for Production and Development]]></title>
    <link href="http://matthewrudy.github.com/blog/2013/01/13/configuring-foreman-for-production-and-development/"/>
    <updated>2013-01-13T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2013/01/13/configuring-foreman-for-production-and-development</id>
    <content type="html"><![CDATA[<p>I follow the convention;</p>

<ul>
<li><code>Procfile</code> defines <em>all</em> processes</li>
<li><code>.foreman</code> sets specific foreman variables</li>
</ul>


<p>Development:</p>

<ul>
<li><code>.env</code> sets environment variables for each developer</li>
<li><code>.env.example</code> sets defaults for development</li>
<li><code>foreman start</code> starts all processes</li>
</ul>


<p>Production:</p>

<ul>
<li><code>heroku config</code> sets environment variables</li>
<li><code>heroku ps:scale</code> turns on or off whichever processes are needed for production</li>
</ul>


<p>Here&#8217;s an example from a project.</p>

<figure class='code'><figcaption><span>Procfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">web</span><span class="p">:</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">unicorn_rails</span> <span class="o">-</span><span class="nb">p</span> <span class="vg">$PORT</span> <span class="o">-</span><span class="n">c</span> <span class="o">.</span><span class="n">/config</span><span class="o">/</span><span class="n">unicorn</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">worker</span><span class="p">:</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">jobs</span><span class="p">:</span><span class="n">work</span>
</span><span class='line'><span class="ss">search</span><span class="p">:</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">sunspot</span><span class="p">:</span><span class="ss">solr</span><span class="p">:</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>.env.example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># default S3 bucket</span>
</span><span class='line'><span class="no">S3_KEY</span><span class="o">=</span><span class="n">keykeykeykeykeykey</span>
</span><span class='line'><span class="no">S3_SECRET</span><span class="o">=</span><span class="n">secretsecretsecret</span>
</span><span class='line'><span class="no">S3_BUCKET</span><span class="o">=</span><span class="n">myapp</span><span class="o">-</span><span class="n">development</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>.env</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># developer&#39;s private S3 bucket</span>
</span><span class='line'><span class="no">S3_KEY</span><span class="o">=</span><span class="n">mememememememememe</span>
</span><span class='line'><span class="no">S3_SECRET</span><span class="o">=</span><span class="n">mysecretmysecret</span>
</span><span class='line'><span class="no">S3_BUCKET</span><span class="o">=</span><span class="n">myapp</span><span class="o">-</span><span class="n">development</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>.foreman</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># development port is 3000</span>
</span><span class='line'><span class="ss">port</span><span class="p">:</span> <span class="mi">3000</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The daily `bundle update`]]></title>
    <link href="http://matthewrudy.github.com/blog/2013/01/09/the-daily-bundle-update/"/>
    <updated>2013-01-09T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2013/01/09/the-daily-bundle-update</id>
    <content type="html"><![CDATA[<p>A typical process for me is like this.</p>

<p>I start off with</p>

<ul>
<li>a dependency on Rails 3.1.10</li>
<li>a dependency on any version of koala</li>
</ul>


<p>So my Gemfile says exactly this</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;rails&quot;</span><span class="p">,</span> <span class="s2">&quot;3.1.10&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;koala&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Every day I do a <code>bundle update</code>.
Sometimes there are new versions of gems, sometimes there aren&#8217;t.</p>

<p>One day there is a new version of koala released <code>koala (1.6.0)</code></p>

<p>When I do my daily bundle update everything breaks. It turns out that <code>koala (1.6.0)</code> relies upon <code>faraday (0.8)</code>.</p>

<p>For some reason this breaks my app.</p>

<p>So I realise I have a new dependency, and I add it to my Gemfile.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;rails&quot;</span><span class="p">,</span> <span class="s2">&quot;3.1.10&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;faraday&quot;</span><span class="p">,</span> <span class="s2">&quot;0.7&quot;</span> <span class="c1"># 0.8 breaks for some reason</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dealing with these problems in small doses, on a daily basis, makes it easier to deal with.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cd -Tmp-]]></title>
    <link href="http://matthewrudy.github.com/blog/2011/06/28/cd--tmp-/"/>
    <updated>2011-06-28T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2011/06/28/cd&#8211;tmp-</id>
    <content type="html"><![CDATA[<p>How do I cd to a directory starting with a hypen (-)?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># /var/folders/*whatever*/ has a folder named &#39;-Tmp-&#39;</span>
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>-Caches-/ -Tmp-/
</span><span class='line'>
</span><span class='line'><span class="c"># lets try and CD there</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> -Tmp-
</span><span class='line'>-bash: <span class="nb">cd</span>: -T: invalid option
</span><span class='line'><span class="nb">cd</span>: usage: <span class="nb">cd</span> <span class="o">[</span>-L|-P<span class="o">]</span> <span class="o">[</span>dir<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># or maybe make sure its a directory</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> -Tmp-/
</span><span class='line'>-bash: <span class="nb">cd</span>: -T: invalid option
</span><span class='line'><span class="nb">cd</span>: usage: <span class="nb">cd</span> <span class="o">[</span>-L|-P<span class="o">]</span> <span class="o">[</span>dir<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># try and escape the first -</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="se">\-</span>Tmp-
</span><span class='line'>-bash: <span class="nb">cd</span>: -T: invalid option
</span><span class='line'><span class="nb">cd</span>: usage: <span class="nb">cd</span> <span class="o">[</span>-L|-P<span class="o">]</span> <span class="o">[</span>dir<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># quote it</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="s1">&#39;-Tmp-&#39;</span>
</span><span class='line'>-bash: <span class="nb">cd</span>: -T: invalid option
</span><span class='line'><span class="nb">cd</span>: usage: <span class="nb">cd</span> <span class="o">[</span>-L|-P<span class="o">]</span> <span class="o">[</span>dir<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># double quote it</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="s2">&quot;-Tmp-&quot;</span>
</span><span class='line'>-bash: <span class="nb">cd</span>: -T: invalid option
</span><span class='line'><span class="nb">cd</span>: usage: <span class="nb">cd</span> <span class="o">[</span>-L|-P<span class="o">]</span> <span class="o">[</span>dir<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># escape it in the quotes</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="s1">&#39;\-Tmp-&#39;</span>
</span><span class='line'>-bash: <span class="nb">cd</span>: <span class="se">\-</span>Tmp-: No such file or directory
</span><span class='line'>
</span><span class='line'><span class="c"># escape it in the double quotes</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="s2">&quot;\-Tmp-&quot;</span>
</span><span class='line'>-bash: <span class="nb">cd</span>: <span class="se">\-</span>Tmp-: No such file or directory
</span><span class='line'>
</span><span class='line'><span class="c"># try a &quot;./&quot; hack</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ./-Tmp-/
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;WHOOP&quot;</span>
</span><span class='line'>WHOOP
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fed up of `bundle exec rake`? Control your `rage`!]]></title>
    <link href="http://matthewrudy.github.com/blog/2011/06/02/fed-up-of-bundle-exec-rake-control-your-rage/"/>
    <updated>2011-06-02T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2011/06/02/fed-up-of-bundle-exec-rake-control-your-rage</id>
    <content type="html"><![CDATA[<p>For the past year we&#8217;ve all been happy.</p>
<p>rake was stable at 0.8.7</p>
<p>You could run</p>
<pre>rake</pre>
<p>In any project and it&#8217;d just work.</p>
<p>But now, with the release of rake 0.9.0, sometimes we get this</p>
<pre>RudiMac:3rdhome matthew$ rake
rake aborted!
You have already activated rake 0.9.0,
but your Gemfile requires rake 0.8.7.
Consider using bundle exec.

(See full trace by running task with --trace)
</pre>
<p>And there&#8217;s a simple solution.</p>
<h2><a href="https://gist.github.com/1003927">RAGE!</a></h2>
<pre>#!/usr/bin/env bash
if [ -f Gemfile ]; then
  bundle exec rake $@
else
  rake $@
fi</pre>
<p>Either copy and paste <a href="https://gist.github.com/1003927">the gist</a> into an executable (~/bin/rage maybe)</p>
<p>Or follow these instructions;</p>
<pre>git clone git://gist.github.com/1003927.git ~/rage-gist
mkdir ~/bin
cp ~/rage-gist/rage ~/bin/
chmod a+x ~/bin/rage</pre>
<p>As long as ~/bin is in your path you should be set.</p>
<pre>rage db:migrate test --trace</pre>
<p>BOOM!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I forgot to commit to a feature branch!]]></title>
    <link href="http://matthewrudy.github.com/blog/2011/05/18/i-forgot-to-commit-to-a-feature-branch/"/>
    <updated>2011-05-18T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2011/05/18/i-forgot-to-commit-to-a-feature-branch</id>
    <content type="html"><![CDATA[<p>So I just committed to master</p>
<pre>commit b17a1fbe8f5d59c24a1f2bb50c9905f8345263f5a
Author: Jeffrey Giraffe &lt;Jeffrey.T.Giraffe@gmail.com&gt;
Date:   Wed May 18 18:22:22 2011 +0800
  Started work on an exciting new feature.
</pre>
<p>But I shouldn&#8217;t have.</p>
<p>All features should be in a &#8220;feature branch&#8221;</p>
<p>How do I move my commit onto a different branch?</p>
<p>Luckily I haven&#8217;t pushed yet.</p>
<p>So just start my &#8220;feature branch&#8221; right now.</p>
<pre>git checkout -b exciting-new-feature
git push origin exciting-new-feature</pre>
<p>Then go back to master, and undo the commit</p>
<pre>git checkout master
git reset --hard HEAD~1</pre>
<p>Or if there are 3 commits</p>
<pre>git reset --hard HEAD~3</pre>
<p>Of course, if I&#8217;ve already pushed this would be a little more tricky.</p>
<p>I suggest (for verbosity) you shouldn&#8217;t try to do anything fancy.</p>
<p>Just revert it</p>
<pre>git revert HEAD</pre>
<p>and humbly explain why</p>
<pre>Revert "Started work on an exciting new feature."

This commit is not ready to be on master yet,
and has been moved onto the branch "exciting-new-feature"

This reverts commit b17a1fbe8f5d59c24a1f2bb50c9905f8345263f5a.
</pre>
<p>Boom!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Running a Test Case only when we have internet]]></title>
    <link href="http://matthewrudy.github.com/blog/2011/05/17/running-a-test-case-only-when-we-have-internet/"/>
    <updated>2011-05-17T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2011/05/17/running-a-test-case-only-when-we-have-internet</id>
    <content type="html"><![CDATA[<p>So I have some tests for geocoding, that I want to be run live.</p>
<pre>test "geocoding" do
  record = Address.create!(:address =&gt; "Pretty Cottage, Winding Road, Beautiful Country")
  assert_equal 51.59011, record.latitude
  assert_equal -2.995398, record.longitude
end
</pre>
<p>Of course, these will fail when there&#8217;s no internet.</p>
<p>My choices;</p>
<ul><li>mock the geocoding API</li>
<li>let them fail</li>
<li>only run this test when there&#8217;s internet</li>
</ul><p>I chose the latter.</p>
<p>How do I know I have internet connection?</p>
<p>Can I ping google?</p>
<pre>system "ping -q -c 1 -t 1 google.com 1&gt; /dev/null" #=&gt; true / false</pre>
<p>Complication!</p>
<blockquote>
<p>the above works on OSX (where -t1 sets a timeout of 1 second)</p>
<p>but on Linux -t has a different meaning, and -w1 sets the timeout</p>
<p>Compromise: ignore timeouts for the moment</p>
</blockquote>
<pre>system "ping -q -c 1 google.com 1&gt; /dev/null" #=&gt; true / false</pre>

<p>Stick this in a method</p>
<pre>def requires_internet!
  if can_ping_google?
    yield
  else
    flunk "this test needs to be run when there is internet"
  end
end
</pre>
<p>Now incorporate this into our test.</p>
<pre>test "geocoding" do
  requires_internet! do
    record = Address.create!(:address =&gt; "Pretty Cottage, Winding Road, Beautiful Country")
    assert_equal 50.0, record.latitude
    assert_equal -0.3, record.longitude
  end
end
</pre>
<p>Done.</p>
<p>Here&#8217;s <a title="get the gist?" href="https://gist.github.com/976285">the gist</a>. Fork it and make it better!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I broke RubyGems.org]]></title>
    <link href="http://matthewrudy.github.com/blog/2011/04/01/i-broke-rubygemsorg/"/>
    <updated>2011-04-01T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2011/04/01/i-broke-rubygemsorg</id>
    <content type="html"><![CDATA[<p>Yes that&#8217;s right.</p>
<p>I broke RubyGems.org.</p>
<p>No April Fools Joke! (although this did happen after midnight HKT)</p>
<p>&#8230; I&#8217;ve hidden the cause so they have a chance to fix it&#8230;</p>
<p>&#8230; but its a unicode thing &#8230;</p>
<blockquote></blockquote>
<p>I packaged it with <a title="gem-this makes you a simple `gem this` away from releasing a gem!" href="https://github.com/lazyatom/gem-this">gem-this</a>,  and did a `gem push` it turned out <a href="http://rubygems.org">http://rubygems.org</a> was down!</p>
<p>I went to bed hoping it would go away, and woke up on April 1st morning to find an email;</p>
<blockquote>
<p><span>Hi Matthew! Looks like you just found a bug that made our homepage unhappy.<br/><br/>=&gt; #&lt;Rubygem id: 39928, name: &#8230;,<br/><br/>I straight up deleted that gem. Can you send or paste the gem/gemspec<br/>with that so we can make sure this doesn&#8217;t happen again?<br/><br/>-Nick</span></p>
</blockquote>
<p><span>So, there you go!</span></p>
<p><span>Rubygems.org currently can&#8217;t support unicode gem names!</span></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Upgrading Postgres 8.4 to 9.0 with Homebrew]]></title>
    <link href="http://matthewrudy.github.com/blog/2011/02/23/upgrading-postgres-84-to-90-with-homebrew/"/>
    <updated>2011-02-23T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2011/02/23/upgrading-postgres-84-to-90-with-homebrew</id>
    <content type="html"><![CDATA[<p>I hoped it&#8217;d be as simple as a `brew install postgresql`</p>
<p>And it almost was.</p>
<p>But&#8230;</p>
<pre>RudiMac:merlot matthew$ tail -f /usr/local/var/postgres/server.log
FATAL:  database files are incompatible with server
DETAIL:  The data directory was initialized by PostgreSQL version 8.4, which is not compatible with this version 9.0.3.</pre>
<p>How do I fix the data files?</p>
<p>Turns out there is a `pg_update` method to do this for you.</p>
<p>But it requires a bit of manual work.</p>
<pre># First of all stop the server
launchctl unload -w ~/Library/LaunchAgents/org.postgresql.postgres.plist

# backup the old data directory
mv /usr/local/var/postgres /usr/local/var/postgres.old

# now create a fresh postgres 9 data directory
initdb /usr/local/var/postgres</pre>
<p>Now we&#8217;re ready to do the upgrade.</p>
<pre>pg_upgrade -d /usr/local/var/postgres.844/ -D /usr/local/var/postgres -b /usr/local/Cellar/postgresql/8.4.4/bin -B /usr/local/Cellar/postgresql/9.0.3/bin
...
Upgrade complete
----------------</pre>
<p>Boom Ting</p>
<p>Now just add the launch control back in and we&#8217;re off.</p>
<pre>cp /usr/local/Cellar/postgresql/9.0.3/org.postgresql.postgres.plist ~/Library/LaunchAgents
launchctl load -w ~/Library/LaunchAgents/org.postgresql.postgres.plist</pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hong Kong Ruby Group Christmas Photo]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/12/17/hong-kong-ruby-group-christmas-photo/"/>
    <updated>2010-12-17T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/12/17/hong-kong-ruby-group-christmas-photo</id>
    <content type="html"><![CDATA[<img src="http://www.tumblr.com/photo/1280/rudygems/2342419598/1/tumblr_ldjsb9GeTr1qzqhg9"/>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript parseInt() may not do what you expect!]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/12/03/javascript-parseint-may-not-do-what-you-expect/"/>
    <updated>2010-12-03T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/12/03/javascript-parseint-may-not-do-what-you-expect</id>
    <content type="html"><![CDATA[<p>I was shocked today to find I&#8217;d introduced a bug.</p>
<p>It manifested itself like this;</p>
<p><img src="http://media.tumblr.com/tumblr_lcudp52ibv1qzqesv.png"/></p>
<p>This might seem ok.</p>
<p>Except the &#8220;Number of repayments&#8221; is set by javascript as;</p>
<blockquote>
<p>the number of days interest</p>
<p>less the number of days before repayment begins</p>
</blockquote>
<p>Looking at the dates, the &#8220;number of days before repayment begins&#8221; should be 2.</p>
<p>But the difference is -6.</p>
<p>Something is wrong.</p>
<p>And the answer is here;</p>
<blockquote>
<p>var date_from_field = function(field_id) {<br/>  var field = $(&#8220;#&#8221;+field_id);<br/>  var year, month, day;<br/><br/>  var date_bits = field.val().split(&#8220;-&#8220;);<br/>  var year  = parseInt(date_bits[0]);<br/>  var month = parseInt(date_bits[1]);<br/>  var day = parseInt(date_bits[2]);<br/>  <br/>  return new Date(year,month-1,day);<br/>};</p>
</blockquote>
<p>I take a date field</p>
<blockquote>
<p>&lt;input type=&#8221;date&#8221; value=&#8221;2010-12-08&#8221; /&gt;</p>
</blockquote>
<p>I grab the value</p>
<blockquote>
<p>&#8220;2010-12-08&#8221;</p>
</blockquote>
<p>I split it into year, month, and day</p>
<blockquote>
<p>[&#8220;2010&#8221;, &#8220;12&#8221;, &#8220;08&#8221;]</p>
</blockquote>
<p>I turn them into integers</p>
<blockquote>
<p>[2010, 12, 0]</p>
</blockquote>
<p>Then I make them into a date</p>
<blockquote>
<p>new Date(2010,11,0); // Tue Nov 30&#160;2010</p>
</blockquote>
<p>No problem!</p>
<p>Except&#8230;</p>
<blockquote>
<p>&#8220;2010-12-08&#8221;&#160;!= Tue Nov 30&#160;2010</p>
</blockquote>
<p>The problem is</p>
<blockquote>
<p><strong>parseInt(&#8220;08&#8221;) == 0</strong></p>
<p><strong>parseInt(&#8220;08&#8221;, 10) == 8<br/></strong></p>
</blockquote>
<p>&#8220;08&#8221; is 0 in octal</p>
<p><strong>Always use parseInt(something, 10)<br/></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bundler as a Gemfile dependency]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/11/24/bundler-as-a-gemfile-dependency/"/>
    <updated>2010-11-24T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/11/24/bundler-as-a-gemfile-dependency</id>
    <content type="html"><![CDATA[<p>Bundler is still a work in progress, so you can expect things to change.</p>
<p>One of these things that has changed between Bundler 1.0.6 and Bundler 1.0.7 is that the &#8220;METADATA&#8221; field has been removed.</p>
<p>So I&#8217;m running Bundler 1.0.7 (with no METADATA) and my colleagues are running 1.0.6 (with METADATA)</p>
<p>I keep getting this diff.</p>
<blockquote>$ git diff Gemfile.lock<br/>diff &#8212;git a/Gemfile.lock b/Gemfile.lock<br/>index ec585b3..ee6ba65&#160;100644<br/>&#8212;- a/Gemfile.lock<br/>+++ b/Gemfile.lock<br/>@@ -221,3 +221,7 @@ DEPENDENCIES<br/>   whitelist_mail_proxy<br/>   will_paginate!<br/>   zipruby<br/>-<br/>-<br/>-METADATA<br/>-  version: 1.0.6<br/></blockquote>
<p>I want bundler to manage itself</p>
<blockquote>
<p># self-referential<br/>gem &#8220;bundler&#8221;, &#8220;&gt;=1.0.7&#8221;</p>
</blockquote>
<p>And it works</p>
<p>but the message is a bit unpretty</p>
<blockquote>
<p>RudiMac:merlot matthew$ bundle install<br/><br/>Fetching source index for <a href="http://rubygems.org/">http://rubygems.org/</a><br/>Bundler could not find compatible versions for gem &#8220;bundler&#8221;:<br/>  In Gemfile:<br/>    bundler (&gt;= 1.0.7)<br/><br/>  Current Bundler version:<br/>    bundler (1.0.6)<br/><br/>Your version of Bundler is older than the one requested by the Gemfile.<br/>Perhaps you need to update Bundler by running `gem install bundler`.</p>
</blockquote>
<p>I need to use &#8220;gem install&#8221;?</p>
<p>I wonder if we can patch bundler to install itself.</p>
<p><em>I recommend you always have a &#8220;&gt;= x.x.x&#8221;&#8230; just for jokes try setting</em></p>
<blockquote>
<p>gem &#8220;bundler&#8221;, &#8220;1.0.6&#8221;</p>
</blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Even more Ruby in Chinese]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/11/23/even-more-ruby-in-chinese/"/>
    <updated>2010-11-23T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/11/23/even-more-ruby-in-chinese</id>
    <content type="html"><![CDATA[<p>I realised I can write even more Ruby in Chinese.</p>
<p>The only gotchas are;</p>
<ul><li>don&#8217;t attempt to use Chinese punctuation （”‘＝＋－，。）</li>
<li>it doesn&#8217;t recognise Chinese as uppercase, so you can&#8217;t start a class or Constant name with a chinese character</li>
</ul><p>So here is my code.</p>
<pre><code class="ruby"># encoding: utf-8

class C动物

  def initialize(名字)
    @名字 = 名字
  end
  attr_reader :名字

  def 朋友?(别的)
    true
  end

  def 吃了?
    false
  end

end

class C狗 &lt; C动物
  
  def 朋友?(别的)
    !别的.is_a?(C马泰)
  end

end

class C人 &lt; C动物
end

class C马泰 &lt; C人
  
  def 吃了?(别的)
    别的.is_a?(C狗)
  end

end

我=C马泰.new("马泰")
puts "我的名字是#{我.名字}"
她=C人.new("张学敏")
puts "她的名字是#{她.名字}"

狗=C狗.new("阿财")
puts "狗的名字是#{狗.名字}"

puts "狗是我的朋友吗？#{我.朋友?(狗)}"
puts "我是狗的朋友吗？#{狗.朋友?(我)}"

puts "狗吃了我吗？#{狗.吃了?(我)}"
puts "我吃了狗吗？#{我.吃了?(狗)}"</code></pre>
<p>See the full gist at <a href="https://gist.github.com/711563"><a href="https://gist.github.com/711563">https://gist.github.com/711563</a></a></p>
<p>Maybe I should write a plugin for rails.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby in Chinese]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/10/11/ruby-in-chinese/"/>
    <updated>2010-10-11T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/10/11/ruby-in-chinese</id>
    <content type="html"><![CDATA[<p>in Ruby 1.8, if you try and assign a variable</p>
<blockquote>
<p>你=&#8221;ni3&#8221;</p>
</blockquote>
<p>you&#8217;ll get an error</p>
<blockquote>
<p>Invalid char `\344&#8217; in expression<br/>Invalid char `\275&#8217; in expression<br/>Invalid char `\240&#8217; in expression<br/>syntax error, unexpected &#8216;=&#8217;<br/>你= &#8220;ni3&#8221;</p>
</blockquote>
<p>But in Ruby 1.9 it actually works.</p>
<p>You just need to add a magic &#8220;coding: uft-8&#8221; header to your ruby file.</p>
<blockquote>
<p># coding: utf-8<br/>你= &#8220;ni3&#8221;<br/>好= &#8220;hao3&#8221;<br/>puts(你+好)</p>
</blockquote>
<p>Wham!</p>
<blockquote>
<p>matthew@RuPro:~$ ruby chinese.rb <br/>ni3hao3</p>
</blockquote>
<p>(if you can&#8217;t write chinese, steal my gist <a href="http://gist.github.com/613670">http://gist.github.com/613670</a>)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to delete a file from Git History]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/09/15/how-to-delete-a-file-from-git-history/"/>
    <updated>2010-09-15T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/09/15/how-to-delete-a-file-from-git-history</id>
    <content type="html"><![CDATA[<p>I always think about this problem;</p>
<blockquote>
<p>What happens if I accidentally commit my password into a git repository?</p>
<p>Surely it&#8217;ll be there forever?</p>
</blockquote>
<p>Or</p>
<blockquote>
<p>Oh man&#8230; I just committed a 700mb video file into the repository</p>
<p>It&#8217;s going to take forever to deploy&#8230;</p>
</blockquote>
<p>I&#8217;ve always known &#8220;get rebase&#8221; will probably be the answer</p>
<p>Luckily <a title='The "Pro Git" book' href="http://progit.org/book/ch6-4.html">ProGit</a> knows exactly what to do. </p>
<blockquote>
<p>git filter-branch &#8212;tree-filter &#8216;some-bash-command&#8217; HEAD</p>
</blockquote>
<p>So here&#8217;s my example of how to use it.</p>
<p>I’ve accidentally added a picture of my bum to this rep.</p>
<blockquote>
<p>$ git show 84c344<br/>commit 84c344c1874736a6d063ed45abe21e20815525b9<br/>Author: Matthew Rudy Jacobs &lt;MatthewRudyJacobs@gmail.com&gt;<br/>Date:   Wed Sep 15&#160;18:25:35&#160;2010 +0800<br/><br/>  add my bum<br/><br/>diff &#8212;git a/mybum.jpg b/mybum.jpg<br/>new file mode 100644<br/>index 0000000..018be38<br/>&#8212;- /dev/null<br/>+++ b/mybum.jpg<br/>@@ -0,0 +1 @@<br/>+a picture of my bum</p>
</blockquote>
<p>so let&#8217;s try and wipe it from history.</p>
<blockquote>
<p>$ git filter-branch &#8212;tree-filter &#8216;rm -f mybum.jpg&#8217; HEAD<br/>Rewrite 76a50a3b1b3263d84517c8e6241ec0bf2bf36fdc (4/4)<br/>Ref &#8216;refs/heads/master&#8217; was rewritten</p>
</blockquote>
<p>now commit 84c344 is still there, but it is not in our branch.<br/>Looking at git log, I can see it&#8217;s been rewritten to f59366</p>
<blockquote>
<p>$ git show f59366<br/>commit f59366420a8b753de5a0d2812e0abbfb95fccfdf<br/>Author: Matthew Rudy Jacobs &lt;MatthewRudyJacobs@gmail.com&gt;<br/>Date:   Wed Sep 15&#160;18:25:35&#160;2010 +0800</p>
<p>    add my bum</p>
</blockquote>
<p>so my bum is no longer there. In the working tree, or in history.</p>
<p>Right now <strong>DON&#8217;T git pull</strong> it will merge your commits with the original commits.</p>
<p>You&#8217;ll have achieved nothing (except doubling the number of commits)</p>
<p>I don&#8217;t have an elegant solution&#8230; but this seems the only way.</p>
<blockquote>
<p>delete all remote repositories</p>
<p>and push to them again</p>
</blockquote>
<p>I&#8217;m sure there&#8217;s a better way&#8230; but I haven&#8217;t found it.</p>
<p>Here&#8217;s my example repo <a href="http://github.com/matthewrudy/git-rebase-test"><a href="http://github.com/matthewrudy/git-rebase-test">http://github.com/matthewrudy/git-rebase-test</a></a></p>
<p>go play!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[git pp (git pull && git push)]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/09/08/git-pp-git-push--git-pull/"/>
    <updated>2010-09-08T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/09/08/git-pp-git-push&#8211;git-pull</id>
    <content type="html"><![CDATA[<p>I am addicted to committing (not commitment).</p>

<p>I make small, distinct commits all the time.</p>

<p>But the consequence of this is</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git push origin master
</span><span class='line'>
</span><span class='line'>To git@myServer:myRepo.git
</span><span class='line'>  ! <span class="o">[</span>rejected<span class="o">]</span>        master -&gt; master <span class="o">(</span>non-fast-forward<span class="o">)</span>
</span><span class='line'>  error: failed to push some refs to ‘git@myServer:myRepo.git’
</span><span class='line'>
</span><span class='line'>To prevent you from losing <span class="nb">history</span>, non-fast-forward updates were rejected
</span><span class='line'>
</span><span class='line'>Merge the remote changes <span class="o">(</span>e.g. ‘git pull’<span class="o">)</span> before pushing again.  See the
</span><span class='line'>‘Note about fast-forwards’ section of ‘git push —help’ <span class="k">for </span>details.
</span></code></pre></td></tr></table></div></figure>


<p>I hate getting push failures.</p>

<p>But I don’t trust myself to do a pull beforehand.</p>

<p>Enter a git alias!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat ~/.gitconfig
</span><span class='line'><span class="o">[</span><span class="nb">alias</span><span class="o">]</span>
</span><span class='line'>    <span class="nv">pp</span> <span class="o">=</span> !sh -c ‘git pull <span class="nv">$0</span> <span class="nv">$1</span> <span class="o">&amp;&amp;</span> git push <span class="nv">$0</span> <span class="nv">$1</span>’
</span></code></pre></td></tr></table></div></figure>


<p>Now I am free to “git pp origin master” as much as I want.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git pp origin master
</span><span class='line'>
</span><span class='line'>From myServer:myRepo
</span><span class='line'> * branch            master     -&gt; FETCH_HEAD
</span><span class='line'>Already up-to-date.
</span><span class='line'>Everything up-to-date
</span></code></pre></td></tr></table></div></figure>


<p>SAFE!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OR logic in gmail filters]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/08/27/or-logic-in-gmail-filters/"/>
    <updated>2010-08-27T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/08/27/or-logic-in-gmail-filters</id>
    <content type="html"><![CDATA[<p>I don&#8217;t want to have to read all the emails from my old job,</p>
<p>but I do want to read some of them.</p>
<p>So the obvious answer is using gmail filters, to tag, and archive the ones I don&#8217;t want.</p>
<p>It turns out the emails I don&#8217;t care about are sent to</p>
<blockquote>
<p><strong>notifications@somedomain.com</strong> and <strong>something-notify@otherdomain.com</strong></p>
</blockquote>
<p>I guess it makes sense, but in the filter box we can use the &#8220;<strong>OR</strong>&#8221; keyword</p>
<blockquote>
<p>notifications@somedomain.com<strong> OR</strong> notify@otherdomain.com <strong><br/></strong></p>
</blockquote>
<p><img src="http://media.tumblr.com/tumblr_l7togsaiBI1qzqesv.jpg"/></p>
<p><strong>Boom ting!</strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Stop adding methods to Symbol just to make your DSL look pretty!]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/06/18/stop-adding-methods-to-symbol-just-to-make-your-dsl-look-pretty/"/>
    <updated>2010-06-18T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/06/18/stop-adding-methods-to-symbol-just-to-make-your-dsl-look-pretty</id>
    <content type="html"><![CDATA[<p>I remember the first time I saw <a href="http://datamapper.org">Datamapper</a>.</p>

<p>I liked saying <code>:something.gt something_else</code>.</p>

<p>It was pretty.</p>

<p>But after a while I realised it wasn&#8217;t necessary.</p>

<p>So why are we still building APIs that involve extending Symbol?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># is this really more ugly than</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:age</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:gt</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">})</span>
</span><span class='line'><span class="c1"># this?</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:age</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># is this really more ugly than</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="o">[</span><span class="ss">:age</span><span class="p">,</span> <span class="ss">:desc</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="c1"># this?</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="ss">:age</span><span class="o">.</span><span class="n">desc</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Do I really want Symbol to have all of these methods?</span>
</span><span class='line'><span class="no">Symbol</span><span class="o">.</span><span class="n">unnecessary_instance_methods</span> <span class="o">==</span> <span class="o">[</span>
</span><span class='line'>  <span class="ss">:gt</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:lt</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:gte</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:lte</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:ne</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:in</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:nin</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:mod</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:all</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:exists</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:asc</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:desc</span>
</span><span class='line'><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>I saw <a href="http://railstips.org/blog/archives/2010/06/16/mongomapper-08-goodies-galore">this</a> on an extension called <a href="http://github.com/jnunemaker/plucky">Plucky</a> for <a href="http://github.com/jnunemaker/mongomapper">MongoMapper</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Enterprise Edition still faster than Ruby 1.9.2?]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/06/02/ruby-enterprise-edition-still-faster-than-ruby-192/"/>
    <updated>2010-06-02T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/06/02/ruby-enterprise-edition-still-faster-than-ruby-192</id>
    <content type="html"><![CDATA[<p>With Ruby 1.9.2 due to ship on July 31st, I thought I&#8217;d take Ruby 1.9.2 preview 3 for a spin.</p>
<p>A quick&#8230;</p>
<blockquote>
<p>rvm install ruby-1.9.2-preview3</p>
<p>gem install rails prawn erubis</p>
</blockquote>
<p>&#8230; and we&#8217;re done.</p>
<p>But is it any faster than REE?</p>
<p><strong>What does it mean to be faster?</strong></p>
<p>Perhaps all I care about is how fast my tests run</p>
<blockquote>
<p>rvm use ruby-1.9.2-preview3</p>
<p>time rake</p>
<p>rvm use ree</p>
<p>time rake</p>
<p># repeat..</p>
</blockquote>
<p><strong>My app:</strong></p>
<ul><li> Rails 2.3.6</li>
<li>rails_xss</li>
<li>postgres</li>
<li>~25 models</li>
<li>~25 controllers</li>
</ul><p><strong>My test suite:</strong></p>
<ul><li>~1700 assertions</li>
<li>~95% <a title="rcov_rails for rails coverage" href="http://github.com/matthewrudy/rcov_rails">code coverage</a></li>
</ul><p><strong>Results;</strong></p>
<script src="http://gist.github.com/421949.js?file=ruby-1.9.2-vs-ree-test-suite"></script><p>So REE is consistently 10% faster at running my test suite than Ruby 1.9.2-preview3</p>
<p><strong>Does this matter?</strong></p>
<p>Probably not&#8230; but maybe I can use those extra 5 seconds.</p>
<p><em>(can&#8217;t wait to see if the <a href="http://www.youtube.com/watch?v=ghLCtCwAKqQ">Phusion.nl</a> guys can make Ruby 1.9.2 faster&#8230; )</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ssh -D is your friend!]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/05/04/ssh--d-is-your-friend/"/>
    <updated>2010-05-04T00:00:00+01:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/05/04/ssh&#8211;d-is-your-friend</id>
    <content type="html"><![CDATA[<blockquote>
<p>Are you stuck behind a firewall?</p>
<p>Does your work block access to facebook?</p>
<p>Do you want to watch English Telly from abroad?</p>
</blockquote>
<p><strong>SSH -D is your friend.</strong></p>
<p><br/>All you need to bypass the firewall;</p>
<ul><li>ssh access to a VPS</li>
<li>ssh -D8080 me@myserver.com // keep this open</li>
<li>go to your browser</li>
<li>set &#8220;connect via SOCKS proxy&#8221; on port 8080</li>
<li>keep the ssh connection open</li>
<li>voila!</li>
</ul><p>Your internet access is now piped via your VPS.</p>
<p>This means;</p>
<ul><li>if it is in the UK you can access iPlayer</li>
<li>if it is in the US you can access Hulu</li>
<li>if you were in China you can access&#8230; everything</li>
</ul><p>Boom ting!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails 3 doesn't allow "open" as a Named Scope]]></title>
    <link href="http://matthewrudy.github.com/blog/2010/03/01/rails-3-doesnt-allow-open-as-a-named-scope/"/>
    <updated>2010-03-01T00:00:00+00:00</updated>
    <id>http://matthewrudy.github.com/blog/2010/03/01/rails-3-doesnt-allow-open-as-a-named-scope</id>
    <content type="html"><![CDATA[<p>Rails 3 has involved rewriting pretty much the whole codebase,</p>
<p>Rails 3 gives off the fragrance of a coherent, cohesive framework.</p>
<p>But this one kind of annoys me.</p>
<blockquote>/Users/matthew/.bundle/ruby/1.8/bundler/gems/rails-16a5e918a06649ffac24fd5873b875daf66212ad-master/activerecord/lib/active_record/named_scope.rb:104:in `scope&#8217;: Cannot define scope :open because AbcDef.open method already exists. (ArgumentError)</blockquote>
<p>So, in Rails 3, when defining a named scope, we can&#8217;t override an existing method.</p>
<p>This all makes sense, we don&#8217;t want to inadvertently break anything (although I&#8217;d hope your test would catch such a thing)</p>
<p>But unfortunately, every object in Ruby has an &#8220;open&#8221; method&#8230; so &#8220;open&#8221; suddenly is off the market for named scopes&#8230; bummer</p>
<p>I spent most of day trying to sort this out&#8230; writing a patch&#8230; trying to convince people to apply it&#8230; but the rails core guys wouldn&#8217;t budge.</p>
<p>So here&#8217;s a quick hack I put in an initializer</p>
<pre><code class="ruby"># config/initializers/allow_open_as_a_named_scope.rb
require 'active_record'
class ActiveRecord::Base
  class &lt;&lt; self
    alias :_open :open
    undef_method :open
  end
end</code></pre>
<p>And we&#8217;re done&#8230;</p>
<p>Kind of annoying though. I use &#8220;open&#8221; all the time, because it makes sense</p>
<p>I&#8217;d prefer it if active record just made a logger.warn, and let me make my own decisions</p>
<p><a href="http://github.com/matthewrudy/rude-rails/tree/make_named_scopes_warn_rather_than_raise">My Fork of rails</a>, <a href="http://github.com/matthewrudy/rails3-doesnt-allow-open-as-a-named-scope">My Example of the bug</a>, <a href="http://gist.github.com/306330">My Undef_Method hack</a></p>
]]></content>
  </entry>
  
</feed>
