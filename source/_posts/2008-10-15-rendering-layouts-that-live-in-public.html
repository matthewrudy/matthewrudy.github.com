---
layout: post
title: Rendering layouts that live in /public?
tags:
- code
- ruby
- public
- actionview
- layouts
- templates
---
<p>At work we have the following concept.</p>
<ol><li>a &#8220;site&#8221; has a subset of our content</li>
<li>a &#8220;site&#8221; has a url - eg. &#8220;oursite.com/stickers&#8221; or &#8220;stickersNOTvicars.com&#8221;</li>
<li>a &#8220;site&#8221; can have its own customised layout, or fall back to the default one</li>
</ol><p>How does this work in code?</p>
<ol><li>site.articles (pretty simple)</li>
<li>a whole load of &#8220;route filters&#8221; that match the incoming host</li>
<li>the code I&#8217;m writing about</li>
</ol><p>So, historically we did</p>
<pre><code class="ruby">class ApplicationController
  layout :determine_layout
  def determine_layout
    if File.exists?("#{Rails.root}/public/sites/#{@site.id}/application.rhtml")
      "../../public/sites/#{@site.id}/application"
    else
      "site_default"
    end
  end
end</code></pre>
<p>This was a hack, and it breaks with Rails 2.1.1, so after a day or so playing with the internals of ActionView I discovered this;</p>
<pre><code class="ruby">append_view_path("#{Rails.root}/public/sites")</code></pre>
<p>And it works!</p>
<p>We just need to set;</p>
<pre><code class="ruby">"#{@site.id}/application"</code></pre>
<p>as our layout, and we&#8217;re away.</p>
<p>Site-specific layouts that live in /public!</p>
